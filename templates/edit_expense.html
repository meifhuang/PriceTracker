<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Edit Expense</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/new_expense.css') }}">
  </head>
  <body>
    <main class="container">
      <div class="card">
        <div class="topbar">
          <div class="title">
            <h1>Edit Expense</h1>
            <div class="muted">Modify purchase</div>
          </div>
          <div class="nav-actions">
            <a class="btn light" href="{{ url_for('dashboard') }}">← Dashboard</a>
            <a class="btn" href="{{ url_for('list_expenses') }}">Transactions</a>
          </div>
        </div>

        <form class="expense-form" method="post" action="{{ url_for('edit_expense', expense_id=expense.id) }}" id="expenseForm">
          <label>Item name
            <input name="item_name" id="item_name" required value="{{ expense.item_name or '' }}">
          </label>

          <label>Brand
            <input name="brand" id="brand" value="{{ expense.brand or '' }}">
          </label>

          <label>Qty
            <input name="qty" id="qty" type="number" min="1" step="1" value="{{ expense.qty or 1 }}">
          </label>

          <label>Company
            <input name="company" id="company" required value="{{ expense.company or '' }}">
          </label>

          <label>URL
            <input name="url" id="url" type="url" placeholder="https://" value="{{ expense.url or '' }}">
          </label>

          <label>Type
            <select name="item_type" id="item_type">
              <option value="food" {% if expense.item_type == 'food' %}selected{% endif %}>food</option>
              <option value="litter" {% if expense.item_type == 'litter' %}selected{% endif %}>litter</option>
              <option value="toys" {% if expense.item_type == 'toys' %}selected{% endif %}>toys</option>
              <option value="snacks" {% if expense.item_type == 'snacks' %}selected{% endif %}>snacks</option>
            </select>
          </label>

          <label>Total before tax
            <input name="total_before_tax" id="total_before_tax" type="number" step="0.01" min="0" value="{{ '%.2f'|format(expense.total_before_tax) if expense.total_before_tax is not none }}">
          </label>

          <label>Cashback %
            <input name="cashback_pct" id="cashback_pct" type="number" step="0.01" min="0" max="100" value="{{ '%.2f'|format(expense.cashback_pct) if expense.cashback_pct is not none else 0 }}">
          </label>

          <label>Cashback engine
            <input name="cashback_engine" id="cashback_engine" value="{{ expense.cashback_engine or '' }}">
          </label>

          <!-- visible computed cashback (client-side only) -->
          <label>Cashback amount
            <div class="computed" id="cashback_amount_display">—
            </div>
          </label>

          <label>Total after cashback
            <div class="computed" id="total_after_display">{{ expense.total_after_cashback is not none and ('$' ~ ('%.2f'|format(expense.total_after_cashback))) or '—' }}</div>
            <input name="total_after_cashback" id="total_after_cashback" type="hidden" value="{{ '%.2f'|format(expense.total_after_cashback) if expense.total_after_cashback is not none }}">
          </label>

          <!-- we do not persist cashback_amount in DB; JS will compute it for display and to derive total_after_cashback -->
          <label>Date purchased
            <input name="date_purchased" id="date_purchased" type="date" value="{{ expense.date_purchased.isoformat() if expense.date_purchased }}">
          </label>

          <label>Notes
            <textarea name="notes" id="notes" rows="3">{{ expense.notes or '' }}</textarea>
          </label>

          <div class="actions">
            <button type="submit" class="btn primary">Save</button>
          </div>
        </form>
      </div>
    </main>

    <!-- reuse the same client JS as new_expense to compute cashback & total live -->
    <script src="{{ url_for('static', filename='js/new_expense.js') }}"></script>
  </body>
</html>