
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Expenses</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/new_expense.css') }}">
    <style>
      .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:0.75rem; gap:12px; }
      .topbar .title { display:flex; flex-direction:column; }
      .title h1 { margin:0; color: #0f6d66; }
      .muted { color:#6b8b8a; font-size:0.9rem; }
      table { width:100%; border-collapse:collapse; background: #fff; border-radius:8px; overflow:hidden; box-shadow:0 10px 30px rgba(7,46,46,0.06); }
      th, td { padding: 0.6rem 0.75rem; text-align:left; border-bottom: 1px solid #f1f6f6; font-size:0.95rem; color: #083636; vertical-align: middle; }
      th { background: linear-gradient(180deg,#f8fffe,#f1fbfb); font-weight:600; color: #0f6d66; }
      tr:last-child td { border-bottom: none; }
      a.btn { text-decoration:none; background:#33b4a8; color:#fff; padding:0.45rem 0.7rem; border-radius:8px; font-weight:600; display:inline-block; }
      a.btn.light { background:#fff;color:#1f9b8f;border:1px solid rgba(31,155,143,0.08) }
      .wrap{max-width:1100px;margin:28px auto;padding:18px}
      .card{padding:14px;border-radius:12px;background:#fff}
      @media(max-width:700px){table,thead,tbody,tr,th,td{display:block}thead{display:none}}

      /* Added: make actions consistent and inline */
      .actions-cell { display:flex; gap:8px; align-items:center; }
      .actions-cell form { margin: 0; }
      .btn.small { padding:6px 8px; border-radius:8px; font-size:0.92rem; }
      .btn.light.small { background:#fff; color:#1f9b8f; border:1px solid rgba(31,155,143,0.12); }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <div class="topbar">
          <div class="title">
            <h1>Transactions</h1>
            <div class="muted">All recorded purchases</div>
          </div>
          <div style="display:flex;gap:8px">
            <a class="btn light" href="{{ url_for('dashboard') }}">← Dashboard</a>
            <a class="btn" href="{{ url_for('new_expense_form') }}">+ New Expense</a>
          </div>
        </div>

        {% if expenses %}
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Item</th>
                <th>Brand</th>
                <th>Company</th>
                <th>Type</th>
                <th class="muted">Before</th>
                <th class="muted">Cashback %</th>
                <th class="muted">Cashback</th>
                <th class="muted">After</th>
                <th>Notes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for e in expenses %}
                <tr>
                  <td>{{ (e.date_purchased or e.created_at) }}</td>
                  <td>{{ e.item_name }}</td>
                  <td>{{ e.brand or '' }}</td>
                  <td>{{ e.company }}</td>
                  <td>{{ e.item_type }}</td>
                  <td class="muted">${{ '%.2f'|format(e.total_before_tax or 0) }}</td>
                  <td class="muted">{{ e.cashback_pct is not none and ('%.2f'|format(e.cashback_pct) ~ '%') or '—' }}</td>
                  <td class="muted">${{ '%.2f'|format(e.cashback_amount or 0) }}</td>
                  <td class="muted">${{ '%.2f'|format(e.total_after_cashback or 0) }}</td>
                  <td>{{ e.notes or '' }}</td>
                  <td>
                    <div class="actions-cell">
                      <a class="btn small" href="{{ url_for('edit_expense', expense_id=e.id) }}">Edit</a>
                      <form method="post" action="{{ url_for('delete_expense', expense_id=e.id) }}" onsubmit="return confirm('Delete this expense?');">
                        <button type="submit" class="btn light small">Delete</button>
                      </form>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>No transactions yet. <a href="{{ url_for('new_expense_form') }}">Add one</a>.</p>
        {% endif %}
      </div>
    </div>
  </body>
</html>
